pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include enemy.lua
#include player.lua
#include lance.lua
#include interface.lua
#include tools.lua
#include world.lua
#include main.lua

-->8

-->8

-->8

-->8

-->8
-- stages table
stage = {
current = 1,
time_2_pass = 5,
start_time = time(),
current_time = 0,
max_enemies = 5,
heart_prob = 0,
heart_prob_min = 10,

update = function(self)
		self.current_time = time()-self.start_time
		if self.current_time%self.time_2_pass==0 then
				self.current += 1
				self.max_enemies += 1
				self.heart_prob += rnd(10)-5+self.current/2
				for i=1,self.max_enemies-#enemies do
						self:spawn_enemy()							
				end
		end
		if self.heart_prob <= self.heart_prob_min then
					self.heart_prob=self.heart_prob_min
		end
		if self.heart_prob >= 25 then
					self.heart_prob=self.heart_prob_min
		end
end,

spawn_enemy = function(self)
		local enemy_sprite=36
		local heart_giver_sprite=23
		 a=rnd(100)
		 if a<self.heart_prob then
		 		add(enemies,make_heart_giver(rnd(127),-rnd(50)-10,0.5+rnd(self.current/2),heart_giver_sprite))
		 else
					add(enemies,make_enemy(rnd(127),-rnd(50)-10,0.5+rnd(self.current/2),enemy_sprite))
			end
end,

reseted = function(self)
self.current = 1
self.time_2_pass = 5
self.start_time = time()
self.current_time = 0
self.max_enemies = 5
self.heart_prob = 0
self.heart_prob_min = 10

end

}
__gfx__
000000007777777000000000000000000ff000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000007000007077777770000000000ff000000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700777777777000007000000000888800008888000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000770707077777777700000000f88f0000f88f000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000770707077707070700000000011000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007007777777777070707000000000ff00000f00f000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000707777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777707777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666660000000000000000000000000077777700000000000000000000000000000000000000000000000000000077007700000044000000770000000000000
66666660000000000000000000000000770000770077770000000000000000000000000000000000000000004444466776644444044000007667000000000000
66666660000000000000000000000000700000070700007000000000000000000000000000000000000000004444466776644444044000007667000000000000
66666660000000000000000000000000700770070707707000000000000000000000000000000000000000000000077007700000044000000440000000000000
66666660000500000000000000000000700770070707707000000000000000000000000000000000000000000000000000000000044000000440000000000000
66666660000000000000000000000000700000070700007000000000000000000000000000000000000000000000000000000000766700000440000000000000
66666660000000000000000000000000770000770077770000000000000000000000000000000000000000000000000000000000766700000440000000000000
00000000000000000000000000000000077777700000000000000000000000000000000000000000000000000000000000000000077000000440000000000000
00000000000000000099990000999900710000170071170000000000000000000000000000000000000000000000077777700000000000444000000000000000
007aaa0000aaaa000099990000999900070000700700007000000000000000000000000000000000000000000000766776670000000004404400000000000000
0777aaa00a7aaaa00060060000600600777777777777777700000000000000000000000000000000000000000000466776640000000044000440000000000000
0a7aaaa00aaaaaa00688886006888860710100077000101700000000000000000000000000000000000000000000447007444000000440000044000000000000
0aaaaaa00aaaaaa00678886006888860717106077060171700000000000000000000000000000000000000000004400000004400074400000004447000000000
0aaaaaa00aaaaaa06777888668788886711111077011111700000000000000000000000000000000000000000044000000000440766400000000466700000000
00aaaa0000aaaa006878888668888886777777777777777700000000000000000000000000000000000000000440000000000044766700000000766700000000
00000000000000000666666006666660070110707100001700000000000000000000000000000000000000004400000000000004777000000000077700000000
08800880000000000444444004444440000000000000000077770000777700000000000000000000000000000000000000000000000000000000000000000000
888888880880088054988940549889400000000000000000707033007070bb000000000000000000000000000000000000000000000000000000000000000000
888888880888888045898940458989400000000000000000077733000777bb000000000000000000000000000000000000000000000000000000000000000000
88888888088888805489884054898840000000000033330077004400770044000000000000000000000000000000000000000000000000000000000000000000
88888888088888804544444045444440003333000333333077778000777780000000000000000000000000000000000000000000000000000000000000000000
088888800088880054ffff4054ffff40033333300330303007004000070040000000000000000000000000000000000000000000000000000000000000000000
008888000008800045f8ff4045f8ff40033030300333333077708000777080000000000000000000000000000000000000000000000000000000000000000000
00088000000000000448444004484440033333300333333070704000070740000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010107073a3503835036350353503335031350303502f3502d3502c3502a3502835027350253502435022350203501e3501d3501b3501a35019350173501535013350113500e3500b35009350073500535004350
011000200c043000000000000000246150c04300000000000c043000000000000000246150000000000000000c043000000000000000246150c04300000000000c04300000000000c043246150c0432461524615
